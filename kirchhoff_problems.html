<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kirchhoff's Circuit Problems</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f1923;
      --panel: #1a2736;
      --panel-light: #223344;
      --accent: #00e5ff;
      --accent-dim: #00a0b2;
      --success: #00e676;
      --warning: #ffab00;
      --danger: #ff5252;
      --text: #e0e8f0;
      --text-dim: #7a8fa0;
      --border: #2a3a4a;
      --glow: rgba(0, 229, 255, 0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Background circuit pattern */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(0, 229, 255, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(0, 230, 118, 0.03) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .app {
      position: relative;
      z-index: 1;
      max-width: 860px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 30px 20px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
    }

    .header::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--success), var(--accent));
    }

    .header h1 {
      font-size: 2em;
      font-weight: 800;
      letter-spacing: -0.5px;
      margin-bottom: 6px;
      background: linear-gradient(135deg, var(--accent), var(--success));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header p {
      color: var(--text-dim);
      font-size: 0.95em;
    }

    /* Stats bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }

    .stat-card .label {
      font-size: 0.7em;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-dim);
      margin-bottom: 4px;
    }

    .stat-card .value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.6em;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-card.level .value {
      font-size: 1em;
      padding: 4px 12px;
      border-radius: 20px;
      display: inline-block;
    }

    .stat-card.level .value.easy { background: rgba(0, 230, 118, 0.15); color: var(--success); }
    .stat-card.level .value.medium { background: rgba(255, 171, 0, 0.15); color: var(--warning); }
    .stat-card.level .value.hard { background: rgba(255, 82, 82, 0.15); color: var(--danger); }

    /* Progress bar */
    .progress-container {
      margin-bottom: 24px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.85em;
      color: var(--text-dim);
    }

    .progress-track {
      height: 8px;
      background: var(--panel-light);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--success));
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    /* Question card */
    .question-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 20px;
      position: relative;
    }

    .question-card .q-number {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75em;
      color: var(--accent-dim);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 14px;
    }

    .question-card .q-text {
      font-size: 1.1em;
      line-height: 1.7;
      margin-bottom: 20px;
    }

    .question-card .q-text strong {
      color: var(--accent);
      font-weight: 600;
    }

    /* Circuit diagram */
    .circuit-svg {
      display: block;
      margin: 20px auto;
      max-width: 100%;
    }

    /* Input area */
    .input-group {
      margin-bottom: 12px;
    }

    .input-group label {
      display: block;
      font-size: 0.85em;
      color: var(--text-dim);
      margin-bottom: 6px;
      font-weight: 600;
    }

    .input-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .input-row input {
      flex: 1;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 12px 16px;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: 1em;
      outline: none;
      transition: border-color 0.3s;
    }

    .input-row input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--glow);
    }

    .input-row .unit {
      font-family: 'JetBrains Mono', monospace;
      color: var(--text-dim);
      font-size: 0.9em;
      min-width: 30px;
    }

    /* Direction select */
    .direction-select {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .direction-btn {
      flex: 1;
      padding: 10px;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--bg);
      color: var(--text-dim);
      font-family: 'Outfit', sans-serif;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .direction-btn:hover {
      border-color: var(--accent-dim);
      color: var(--text);
    }

    .direction-btn.selected {
      border-color: var(--accent);
      background: var(--glow);
      color: var(--accent);
      font-weight: 600;
    }

    /* Submit button */
    .submit-btn {
      width: 100%;
      padding: 14px;
      margin-top: 16px;
      background: linear-gradient(135deg, var(--accent-dim), var(--accent));
      border: none;
      border-radius: 12px;
      color: var(--bg);
      font-family: 'Outfit', sans-serif;
      font-size: 1.05em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      letter-spacing: 0.5px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 229, 255, 0.3);
    }

    .submit-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Feedback */
    .feedback {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 0.95em;
      line-height: 1.6;
      display: none;
      animation: fadeSlide 0.3s ease;
    }

    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .feedback.correct {
      display: block;
      background: rgba(0, 230, 118, 0.1);
      border: 1px solid rgba(0, 230, 118, 0.3);
      color: var(--success);
    }

    .feedback.incorrect {
      display: block;
      background: rgba(255, 82, 82, 0.1);
      border: 1px solid rgba(255, 82, 82, 0.3);
      color: var(--danger);
    }

    .feedback.sigfig {
      display: block;
      background: rgba(255, 171, 0, 0.1);
      border: 1px solid rgba(255, 171, 0, 0.3);
      color: var(--warning);
    }

    .feedback .work {
      margin-top: 10px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.88em;
      white-space: pre-wrap;
    }

    /* Next button */
    .next-btn {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      background: var(--panel-light);
      border: 2px solid var(--accent);
      border-radius: 12px;
      color: var(--accent);
      font-family: 'Outfit', sans-serif;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: none;
    }

    .next-btn:hover {
      background: var(--glow);
      transform: translateY(-2px);
    }

    /* Formula reference */
    .formula-ref {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px 24px;
      margin-bottom: 24px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      color: var(--text-dim);
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .formula-ref span {
      color: var(--accent);
    }

    /* Mastery overlay */
    .mastery-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(15, 25, 35, 0.95);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.5s ease;
    }

    .mastery-overlay.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .mastery-card {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      max-width: 520px;
      width: 90%;
      box-shadow: 0 0 60px rgba(0, 229, 255, 0.2);
      animation: scaleIn 0.5s ease;
    }

    @keyframes scaleIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .mastery-card .trophy {
      font-size: 4em;
      margin-bottom: 16px;
    }

    .mastery-card h2 {
      font-size: 2em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent), var(--success));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .mastery-card .mastery-stats {
      margin: 20px 0;
      font-size: 0.95em;
      color: var(--text-dim);
      line-height: 1.8;
    }

    .mastery-card .mastery-stats strong {
      color: var(--text);
    }

    .mastery-name-input {
      width: 100%;
      padding: 14px;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-family: 'Outfit', sans-serif;
      font-size: 1em;
      text-align: center;
      margin: 16px 0;
      outline: none;
    }

    .mastery-name-input:focus {
      border-color: var(--accent);
    }

    .mastery-card .timestamp {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8em;
      color: var(--text-dim);
      margin-top: 12px;
    }

    .mastery-card .instructions {
      margin-top: 16px;
      padding: 14px;
      background: rgba(0, 229, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 0.85em;
      color: var(--text-dim);
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .stats-bar { grid-template-columns: repeat(2, 1fr); }
      .header h1 { font-size: 1.5em; }
      .question-card { padding: 20px; }
      .mastery-card { padding: 24px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <h1>‚ö° Kirchhoff's Circuit Problems</h1>
      <p>Energy in Electric Circuits ‚Äî Adaptive Practice</p>
    </div>

    <div class="stats-bar">
      <div class="stat-card">
        <div class="label">Correct</div>
        <div class="value" id="correctCount">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Total</div>
        <div class="value" id="totalCount">0</div>
      </div>
      <div class="stat-card">
        <div class="label">Streak</div>
        <div class="value" id="streakCount">0</div>
      </div>
      <div class="stat-card level">
        <div class="label">Level</div>
        <div class="value easy" id="levelBadge">Easy</div>
      </div>
    </div>

    <div class="progress-container">
      <div class="progress-header">
        <span>Mastery Progress</span>
        <span id="progressText">0 / 5 correct needed</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
    </div>

    <div class="formula-ref">
      <div>Ohm's Law: <span>I = V / R</span></div>
      <div>Loop Rule: <span>Œ£V = 0</span></div>
      <div>Junction Rule: <span>I<sub>in</sub> = I<sub>out</sub></span></div>
      <div>Series: <span>V = I(R‚ÇÅ+R‚ÇÇ)</span></div>
    </div>

    <div id="questionArea"></div>
  </div>

  <div class="mastery-overlay" id="masteryOverlay">
    <div class="mastery-card">
      <div class="trophy">üèÜ</div>
      <h2>MASTERY ACHIEVED!</h2>
      <div class="mastery-stats" id="masteryStats"></div>
      <input type="text" class="mastery-name-input" id="nameInput" placeholder="Enter your name for screenshot">
      <div class="timestamp" id="masteryTimestamp"></div>
      <div class="instructions">
        üì∏ Take a screenshot of this screen and submit to Schoology as proof of mastery.
      </div>
    </div>
  </div>

  <script>
    // ====== STATE ======
    let correct = 0;
    let total = 0;
    let streak = 0;
    let bestStreak = 0;
    let level = 0; // 0=easy, 1=medium, 2=hard
    let consecutiveCorrect = 0;
    let consecutiveWrong = 0;
    const MASTERY_TARGET = 5;
    let currentProblem = null;
    let answered = false;

    // ====== UTILITIES ======
    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function randDec(min, max, dp) { return parseFloat((Math.random() * (max - min) + min).toFixed(dp)); }

    function countSigFigs(val) {
      let s = String(val);
      s = s.replace(/^-/, '');
      if (s.includes('.')) {
        s = s.replace(/^0+/, '');
        if (s.startsWith('.')) return s.replace('.', '').replace(/^0+/, '').length || 1;
        return s.replace('.', '').length;
      }
      s = s.replace(/^0+/, '');
      return s.replace(/0+$/, '').length || 1;
    }

    function roundToSigFigs(num, sf) {
      if (num === 0) return 0;
      const d = Math.ceil(Math.log10(Math.abs(num)));
      const power = sf - d;
      const magnitude = Math.pow(10, power);
      const shifted = Math.round(num * magnitude);
      return shifted / magnitude;
    }

    function minSF(...vals) {
      return Math.min(...vals.map(v => countSigFigs(v)));
    }

    function checkAnswer(student, expected, sf) {
      const numStudent = parseFloat(student);
      if (isNaN(numStudent)) return { status: 'wrong' };

      // Accept within 5% of the correctly rounded answer
      const rounded = roundToSigFigs(expected, sf);
      const tolerance = Math.max(Math.abs(rounded) * 0.05, 0.01);

      if (Math.abs(numStudent - rounded) <= tolerance) {
        return { status: 'correct' };
      }
      // Also accept if close to unrounded
      if (Math.abs(numStudent - expected) <= tolerance) {
        return { status: 'correct' };
      }
      return { status: 'wrong' };
    }

    // ====== CIRCUIT DIAGRAMS - Embedded from textbook ======
    const CIRCUIT_IMG_TWO_LOOP = '<img class="circuit-svg" src="data:image/jpeg;base64,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" alt="Two-loop circuit" style="max-width:380px;background:#fff;padding:10px;border-radius:8px;border:1px solid var(--border);">';
    const CIRCUIT_IMG_THREE_SOURCE = '<img class="circuit-svg" src="data:image/jpeg;base64,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" alt="Three-source circuit" style="max-width:380px;background:#fff;padding:10px;border-radius:8px;border:1px solid var(--border);">';
    function svgTwoLoop() { return CIRCUIT_IMG_TWO_LOOP; }
    function svgThreeSource() { return CIRCUIT_IMG_THREE_SOURCE; }

    // ====== PROBLEM GENERATORS ======
    // EASY LEVEL: Simple Ohm's law and single-loop circuits
    const easyProblems = [
      // Type 0: Basic Ohm's Law - find current
      function() {
        const V = randDec(6.0, 30.0, 1);
        const R = randDec(2.0, 20.0, 1);
        const I = V / R;
        const sf = 3;
        return {
          html: `A single battery with voltage <strong>${V} V</strong> is connected to a single resistor of <strong>${R} Œ©</strong>. Using Ohm's Law, find the current in the circuit.`,
          inputs: [{ label: 'Current (I)', unit: 'A', key: 'I' }],
          directions: false,
          answers: { I: { value: I, sf: sf } },
          work: `I = V / R = ${V} V / ${R} Œ© = ${roundToSigFigs(I, sf)} A`,
          feedback: `The current is found by dividing voltage by resistance.`
        };
      },
      // Type 1: Ohm's Law - find voltage
      function() {
        const I = randDec(0.50, 5.0, 2);
        const R = randDec(4.0, 25.0, 1);
        const V = I * R;
        const sf = 2;
        return {
          html: `A circuit carries a current of <strong>${I} A</strong> through a resistor of <strong>${R} Œ©</strong>. What is the voltage across the resistor?`,
          inputs: [{ label: 'Voltage (V)', unit: 'V', key: 'V' }],
          directions: false,
          answers: { V: { value: V, sf: sf } },
          work: `V = IR = (${I} A)(${R} Œ©) = ${roundToSigFigs(V, sf)} V`,
          feedback: `Voltage equals current times resistance.`
        };
      },
      // Type 2: Two resistors in series, find current
      function() {
        const V = randDec(6.0, 30.0, 1);
        const R1 = randDec(3.0, 15.0, 1);
        const R2 = randDec(3.0, 15.0, 1);
        const I = V / (R1 + R2);
        const sf = 3;
        return {
          html: `A <strong>${V} V</strong> battery is connected to two resistors in series: <strong>R‚ÇÅ = ${R1} Œ©</strong> and <strong>R‚ÇÇ = ${R2} Œ©</strong>. Using Kirchhoff's loop rule (V ‚àí IR‚ÇÅ ‚àí IR‚ÇÇ = 0), find the current.`,
          inputs: [{ label: 'Current (I)', unit: 'A', key: 'I' }],
          directions: false,
          answers: { I: { value: I, sf: sf } },
          work: `V ‚àí IR‚ÇÅ ‚àí IR‚ÇÇ = 0\n${V} = I(${R1} + ${R2})\nI = ${V} / ${R1 + R2} = ${roundToSigFigs(I, sf)} A`,
          feedback: `In a series circuit, use the loop rule: V = I(R‚ÇÅ + R‚ÇÇ), then solve for I.`
        };
      },
      // Type 3: Find resistance given V and I
      function() {
        const V = randDec(6.0, 30.0, 1);
        const I = randDec(0.50, 4.0, 2);
        const R = V / I;
        const sf = 2;
        return {
          html: `A battery provides <strong>${V} V</strong> and the current in the circuit is measured at <strong>${I} A</strong>. What is the resistance of the resistor?`,
          inputs: [{ label: 'Resistance (R)', unit: 'Œ©', key: 'R' }],
          directions: false,
          answers: { R: { value: R, sf: sf } },
          work: `R = V / I = ${V} V / ${I} A = ${roundToSigFigs(R, sf)} Œ©`,
          feedback: `Rearrange Ohm's Law: R = V / I.`
        };
      }
    ];

    // MEDIUM LEVEL: Two-loop circuits, find one current
    const mediumProblems = [
      // Type 0: Two-loop with two batteries (like sample problem)
      function() {
        const R1 = rand(50, 200);
        const R2 = rand(50, 200);
        const R3 = rand(50, 200);
        const V1 = randDec(4.0, 12.0, 1);
        const V2 = randDec(12.0, 24.0, 1);
        // Loop A: V2 - V1 - I1*R3 = 0 ‚Üí I1 = (V2-V1)/R3
        const I1 = (V2 - V1) / R3;
        const sf = 2;

        return {
          html: `In the two-loop circuit shown, all batteries provide the labeled voltages. <strong>V‚ÇÅ = ${V1} V</strong>, <strong>V‚ÇÇ = ${V2} V</strong>, <strong>R‚ÇÅ = ${R1} Œ©</strong>, <strong>R‚ÇÇ = ${R2} Œ©</strong>, <strong>R‚ÇÉ = ${R3} Œ©</strong>. The batteries are oriented in opposite directions within Loop A. Find I‚ÇÅ using the Loop A equation: V‚ÇÇ ‚àí V‚ÇÅ ‚àí I‚ÇÅR‚ÇÉ = 0.`,
          diagram: svgTwoLoop({ V1, V2, R1, R2, R3 }),
          inputs: [{ label: 'I‚ÇÅ', unit: 'A', key: 'I1' }],
          directions: false,
          answers: { I1: { value: I1, sf: sf } },
          work: `V‚ÇÇ ‚àí V‚ÇÅ ‚àí I‚ÇÅR‚ÇÉ = 0\n${V2} ‚àí ${V1} ‚àí I‚ÇÅ(${R3}) = 0\nI‚ÇÅ = ${roundToSigFigs(V2 - V1, 2)} / ${R3} = ${roundToSigFigs(I1, sf)} A`,
          feedback: `Use the Loop A equation. Since V‚ÇÇ > V‚ÇÅ and they oppose each other, the net voltage is V‚ÇÇ ‚àí V‚ÇÅ.`
        };
      },
      // Type 1: Two-loop, find I2 from Loop B
      function() {
        const R1 = rand(40, 150);
        const R2 = rand(40, 150);
        const R3 = rand(40, 150);
        const V2 = randDec(8.0, 24.0, 1);
        // Loop B: V2 - I2*R1 - I2*R2 = 0 ‚Üí I2 = V2/(R1+R2)
        const I2 = V2 / (R1 + R2);
        const sf = 2;

        return {
          html: `In the two-loop circuit shown, <strong>V‚ÇÇ = ${V2} V</strong>, <strong>R‚ÇÅ = ${R1} Œ©</strong>, <strong>R‚ÇÇ = ${R2} Œ©</strong>, <strong>R‚ÇÉ = ${R3} Œ©</strong>. Find I‚ÇÇ using Loop B equation: V‚ÇÇ ‚àí I‚ÇÇR‚ÇÅ ‚àí I‚ÇÇR‚ÇÇ = 0.`,
          diagram: svgTwoLoop({ V2, R1, R2, R3 }),
          inputs: [{ label: 'I‚ÇÇ', unit: 'A', key: 'I2' }],
          directions: false,
          answers: { I2: { value: I2, sf: sf } },
          work: `V‚ÇÇ ‚àí I‚ÇÇR‚ÇÅ ‚àí I‚ÇÇR‚ÇÇ = 0\n${V2} = I‚ÇÇ(${R1} + ${R2})\nI‚ÇÇ = ${V2} / ${R1 + R2} = ${roundToSigFigs(I2, sf)} A`,
          feedback: `Loop B contains V‚ÇÇ, R‚ÇÅ, and R‚ÇÇ. Factor out I‚ÇÇ and solve.`
        };
      },
      // Type 2: Find total current using junction rule
      function() {
        const R1 = rand(80, 200);
        const R2 = rand(80, 200);
        const R3 = rand(80, 200);
        const V1 = rand(4, 10);
        const V2 = rand(10, 24);
        const I1 = (V2 - V1) / R3;
        const I2 = V2 / (R1 + R2);
        const I = I1 + I2;
        const sf = 2; // Keep it clean

        return {
          html: `In a two-loop circuit, you've calculated <strong>I‚ÇÅ = ${roundToSigFigs(I1, sf)} A</strong> and <strong>I‚ÇÇ = ${roundToSigFigs(I2, sf)} A</strong>. Using Kirchhoff's junction rule (I = I‚ÇÅ + I‚ÇÇ), find the total current.`,
          inputs: [{ label: 'Total Current (I)', unit: 'A', key: 'I' }],
          directions: false,
          answers: { I: { value: I, sf: sf } },
          work: `I = I‚ÇÅ + I‚ÇÇ = ${roundToSigFigs(I1, sf)} + ${roundToSigFigs(I2, sf)} = ${roundToSigFigs(I, sf)} A`,
          feedback: `The junction rule tells us total current is the sum of branch currents.`
        };
      },
      // Type 3: Single loop with two batteries same direction
      function() {
        const V1 = randDec(4.0, 15.0, 1);
        const V2 = randDec(4.0, 15.0, 1);
        const R = randDec(5.0, 30.0, 1);
        const I = (V1 + V2) / R;
        const sf = 2;

        return {
          html: `Two batteries (<strong>V‚ÇÅ = ${V1} V</strong> and <strong>V‚ÇÇ = ${V2} V</strong>) are connected in the same direction with a single <strong>${R} Œ©</strong> resistor. Using the modified loop rule (V‚ÇÅ + V‚ÇÇ = IR), find the current.`,
          inputs: [{ label: 'Current (I)', unit: 'A', key: 'I' }],
          directions: false,
          answers: { I: { value: I, sf: sf } },
          work: `V‚ÇÅ + V‚ÇÇ = IR\nI = (${V1} + ${V2}) / ${R} = ${V1 + V2} / ${R} = ${roundToSigFigs(I, sf)} A`,
          feedback: `When batteries are oriented the same way, their voltages add up.`
        };
      }
    ];

    // HARD LEVEL: Multi-loop with 3 voltage sources, direction + magnitude (like Q4, Q5, Q6)
    const hardProblems = [
      // Type 0: Like Q4 - two-loop, 3 sources, find both currents with direction
      function() {
        const V1 = randDec(4.0, 12.0, 1);
        const V2 = randDec(5.0, 15.0, 1);
        const V3 = randDec(6.0, 18.0, 1);
        const R1 = randDec(2.0, 10.0, 1);
        const R2 = randDec(4.0, 15.0, 1);
        // Circuit like Q4: 
        // Loop A (left): V1 + V2 - I1*R1 = 0 ‚Üí I1 = (V1+V2)/R1
        // Loop B (right): V3 - V2 - I2*R2 = 0 ‚Üí I2 = (V3-V2)/R2
        // Need to ensure some have clear directions
        const I1val = (V1 + V2) / R1;
        const sf1 = 2;
        // For loop B, might get negative ‚Üí direction matters
        const I2raw = (V3 - V2) / R2;
        const sf2 = 2;

        return {
          html: `For the circuit shown, <strong>V‚ÇÅ = ${V1} V</strong>, <strong>V‚ÇÇ = ${V2} V</strong>, <strong>V‚ÇÉ = ${V3} V</strong>, <strong>R‚ÇÅ = ${R1} Œ©</strong>, <strong>R‚ÇÇ = ${R2} Œ©</strong>.<br><br>Loop A: V‚ÇÅ + V‚ÇÇ ‚àí I‚ÇÅR‚ÇÅ = 0<br>Loop B: V‚ÇÉ ‚àí V‚ÇÇ ‚àí I‚ÇÇR‚ÇÇ = 0<br><br>Find the magnitude of the current through <strong>R‚ÇÅ</strong>.`,
          diagram: svgTwoLoop({ V1, V2, V3, R1, R2 }),
          inputs: [{ label: 'I‚ÇÅ (magnitude)', unit: 'A', key: 'I1' }],
          directions: true,
          directionKey: 'dir1',
          directionAnswer: 'ccw',
          answers: { I1: { value: I1val, sf: sf1 } },
          work: `Loop A: V‚ÇÅ + V‚ÇÇ ‚àí I‚ÇÅR‚ÇÅ = 0\nI‚ÇÅ = (${V1} + ${V2}) / ${R1} = ${V1 + V2} / ${R1} = ${roundToSigFigs(I1val, sf1)} A\nDirection: counterclockwise (conventional current from + terminal)`,
          feedback: `Apply the loop rule to Loop A. The combined EMFs drive current counterclockwise through R‚ÇÅ.`
        };
      },
      // Type 1: Three-source circuit like Q5 - find current through R1
      function() {
        const V1 = randDec(10.0, 24.0, 1);
        const V2 = randDec(8.0, 20.0, 1);
        const V3 = randDec(10.0, 22.0, 1);
        const R1 = rand(8, 20);
        const R2 = rand(8, 20);
        const R3 = randDec(4.0, 12.0, 1);
        const I1 = (V1 + V2) / R1;
        const sf = 2;
        const dir = I1 > 0 ? 'cw' : 'ccw';

        return {
          html: `In the circuit shown, <strong>V‚ÇÅ = ${V1} V</strong>, <strong>V‚ÇÇ = ${V2} V</strong>, <strong>V‚ÇÉ = ${V3} V</strong>, <strong>R‚ÇÅ = ${R1} Œ©</strong>, <strong>R‚ÇÇ = ${R2} Œ©</strong>, <strong>R‚ÇÉ = ${R3} Œ©</strong>.<br><br>Using the loop containing V‚ÇÅ, V‚ÇÇ, and R‚ÇÅ, determine the current through R‚ÇÅ.<br>Loop equation: V‚ÇÅ + V‚ÇÇ ‚àí I‚ÇÅR‚ÇÅ = 0`,
          diagram: svgThreeSource({ V1, V2, V3, R1, R2, R3 }),
          inputs: [{ label: 'I‚ÇÅ (magnitude)', unit: 'A', key: 'I1' }],
          directions: true,
          directionKey: 'dir1',
          directionAnswer: 'cw',
          answers: { I1: { value: Math.abs(I1), sf: sf } },
          work: `V‚ÇÅ + V‚ÇÇ ‚àí I‚ÇÅR‚ÇÅ = 0\nI‚ÇÅ = (${V1} + ${V2}) / ${R1} = ${roundToSigFigs(V1 + V2, 3)} / ${R1} = ${roundToSigFigs(Math.abs(I1), sf)} A clockwise`,
          feedback: `Apply the loop rule. The sum of voltages V‚ÇÅ and V‚ÇÇ drives the current clockwise through R‚ÇÅ.`
        };
      },
      // Type 2: Three-source circuit - find current through R3 (like Q6)
      function() {
        const V2 = randDec(8.0, 18.0, 1);
        const V3 = randDec(10.0, 22.0, 1);
        const R2 = rand(8, 18);
        const R3 = randDec(4.0, 12.0, 1);
        const netV = V3 - V2;
        const I3raw = netV / R3;
        const sf = 2;
        const dir = I3raw >= 0 ? 'ccw' : 'cw';

        return {
          html: `In the same type of three-source circuit, <strong>V‚ÇÇ = ${V2} V</strong>, <strong>V‚ÇÉ = ${V3} V</strong>, <strong>R‚ÇÇ = ${R2} Œ©</strong>, <strong>R‚ÇÉ = ${R3} Œ©</strong>.<br><br>Using the loop containing V‚ÇÇ, V‚ÇÉ, and R‚ÇÉ, find the current through R‚ÇÉ.<br>Loop equation: V‚ÇÉ ‚àí V‚ÇÇ ‚àí I‚ÇÉR‚ÇÉ = 0`,
          diagram: svgThreeSource({ V2, V3, R2, R3 }),
          inputs: [{ label: 'I‚ÇÉ (magnitude)', unit: 'A', key: 'I3' }],
          directions: true,
          directionKey: 'dir3',
          directionAnswer: dir === 'ccw' ? 'ccw' : 'cw',
          answers: { I3: { value: Math.abs(I3raw), sf: sf } },
          work: `V‚ÇÉ ‚àí V‚ÇÇ ‚àí I‚ÇÉR‚ÇÉ = 0\nI‚ÇÉ = (${V3} ‚àí ${V2}) / ${R3} = ${roundToSigFigs(netV, 2)} / ${R3} = ${roundToSigFigs(Math.abs(I3raw), sf)} A ${dir === 'ccw' ? 'counterclockwise' : 'clockwise'}`,
          feedback: `The net voltage (V‚ÇÉ ‚àí V‚ÇÇ) determines both the magnitude and direction of current through R‚ÇÉ.${netV < 0 ? ' Since V‚ÇÇ > V‚ÇÉ, the current flows in the opposite direction from what the equation assumed.' : ''}`
        };
      },
      // Type 3: Full multi-loop solve - find total current with junction rule
      function() {
        const V1 = randDec(12.0, 24.0, 1);
        const V2 = randDec(8.0, 16.0, 1);
        const V3 = randDec(10.0, 20.0, 1);
        const R1 = rand(8, 20);
        const R2 = rand(8, 20);
        const R3 = rand(5, 15);

        const I1 = (V1 + V2) / R1;
        const I3 = Math.abs(V3 - V2) / R3;
        const Itotal = I1 + I3;
        const sf = 2;

        return {
          html: `In a three-source, two-loop circuit: <strong>V‚ÇÅ = ${V1} V</strong>, <strong>V‚ÇÇ = ${V2} V</strong>, <strong>V‚ÇÉ = ${V3} V</strong>, <strong>R‚ÇÅ = ${R1} Œ©</strong>, <strong>R‚ÇÇ = ${R2} Œ©</strong>, <strong>R‚ÇÉ = ${R3} Œ©</strong>.<br><br>You've found:<br>I‚ÇÅ = (V‚ÇÅ + V‚ÇÇ)/R‚ÇÅ = ${roundToSigFigs(I1, sf)} A<br>I‚ÇÉ = |V‚ÇÉ ‚àí V‚ÇÇ|/R‚ÇÉ = ${roundToSigFigs(I3, sf)} A<br><br>Using the junction rule, find the total current entering the top junction.`,
          diagram: svgThreeSource({ V1, V2, V3, R1, R2, R3 }),
          inputs: [{ label: 'Total Current (I)', unit: 'A', key: 'I' }],
          directions: false,
          answers: { I: { value: Itotal, sf: sf } },
          work: `I = I‚ÇÅ + I‚ÇÉ = ${roundToSigFigs(I1, sf)} + ${roundToSigFigs(I3, sf)} = ${roundToSigFigs(Itotal, sf)} A`,
          feedback: `By the junction rule, the total current is the sum of all branch currents entering the junction.`
        };
      }
    ];

    // ====== GENERATE PROBLEM ======
    function generateProblem() {
      const pools = [easyProblems, mediumProblems, hardProblems];
      const pool = pools[level];
      const generator = pool[Math.floor(Math.random() * pool.length)];
      currentProblem = generator();
      answered = false;
      renderProblem();
    }

    function renderProblem() {
      const area = document.getElementById('questionArea');
      const levelNames = ['Easy', 'Medium', 'Hard'];
      const p = currentProblem;

      let html = `
        <div class="question-card">
          <div class="q-number">Problem ${total + 1} ‚Ä¢ ${levelNames[level]} Level</div>
          <div class="q-text">${p.html}</div>
          ${p.diagram || ''}
      `;

      // Input fields
      p.inputs.forEach(inp => {
        html += `
          <div class="input-group">
            <label>${inp.label}</label>
            <div class="input-row">
              <input type="text" id="input_${inp.key}" placeholder="Enter value..." 
                     onkeydown="if(event.key==='Enter') submitAnswer()">
              <span class="unit">${inp.unit}</span>
            </div>
          </div>
        `;
      });

      // Direction selection if needed
      if (p.directions) {
        html += `
          <div class="input-group">
            <label>Direction of current</label>
            <div class="direction-select">
              <button class="direction-btn" onclick="selectDirection(this, '${p.directionKey}', 'cw')">‚Üª Clockwise</button>
              <button class="direction-btn" onclick="selectDirection(this, '${p.directionKey}', 'ccw')">‚Ü∫ Counter-clockwise</button>
            </div>
          </div>
        `;
      }

      html += `
          <button class="submit-btn" id="submitBtn" onclick="submitAnswer()">Check Answer</button>
          <div class="feedback" id="feedback"></div>
          <button class="next-btn" id="nextBtn" onclick="generateProblem()">Next Problem ‚Üí</button>
        </div>
      `;

      area.innerHTML = html;
      // Focus first input
      setTimeout(() => {
        const firstInput = area.querySelector('input[type="text"]');
        if (firstInput) firstInput.focus();
      }, 100);
    }

    let selectedDirections = {};

    function selectDirection(btn, key, value) {
      selectedDirections[key] = value;
      const siblings = btn.parentElement.querySelectorAll('.direction-btn');
      siblings.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    }

    // ====== SUBMIT ANSWER ======
    function submitAnswer() {
      if (answered) return;
      const p = currentProblem;
      const fb = document.getElementById('feedback');
      let allCorrect = true;
      let hasSigFigIssue = false;
      let feedbackHTML = '';

      // Check each input
      for (const inp of p.inputs) {
        const el = document.getElementById(`input_${inp.key}`);
        const studentVal = el.value.trim();
        if (!studentVal) {
          fb.className = 'feedback incorrect';
          fb.innerHTML = '‚ö†Ô∏è Please enter a value before submitting.';
          return;
        }

        const ans = p.answers[inp.key];
        const result = checkAnswer(studentVal, ans.value, ans.sf);

        if (result.status === 'wrong') {
          allCorrect = false;
        } else if (result.status === 'sigfig') {
          hasSigFigIssue = true;
          allCorrect = false;
        }
      }

      // Check direction if needed
      let directionCorrect = true;
      if (p.directions) {
        const selected = selectedDirections[p.directionKey];
        if (!selected) {
          fb.className = 'feedback incorrect';
          fb.innerHTML = '‚ö†Ô∏è Please select a direction before submitting.';
          return;
        }
        if (selected !== p.directionAnswer) {
          directionCorrect = false;
          allCorrect = false;
        }
      }

      answered = true;
      total++;
      document.getElementById('submitBtn').disabled = true;

      if (allCorrect && !hasSigFigIssue) {
        correct++;
        streak++;
        if (streak > bestStreak) bestStreak = streak;
        consecutiveCorrect++;
        consecutiveWrong = 0;

        feedbackHTML = `‚úÖ Correct! ${p.feedback}`;
        if (p.work) feedbackHTML += `<div class="work">${p.work}</div>`;
        fb.className = 'feedback correct';

        // Level up after 2 consecutive correct
        if (consecutiveCorrect >= 2 && level < 2) {
          level++;
          consecutiveCorrect = 0;
          feedbackHTML += `<br><br>‚¨ÜÔ∏è <strong>Level Up!</strong> Moving to ${['Easy', 'Medium', 'Hard'][level]} level.`;
        }
      } else if (hasSigFigIssue) {
        streak = 0;
        consecutiveCorrect = 0;
        consecutiveWrong++;

        feedbackHTML = `‚ö†Ô∏è Your numerical answer is close, but check your <strong>significant figures</strong>. Match the sig figs of the given values.`;
        if (p.work) feedbackHTML += `<div class="work">${p.work}</div>`;
        fb.className = 'feedback sigfig';
      } else {
        streak = 0;
        consecutiveCorrect = 0;
        consecutiveWrong++;

        feedbackHTML = `‚ùå Not quite.`;
        if (!directionCorrect && p.directions) {
          feedbackHTML += ` The direction is ${p.directionAnswer === 'cw' ? 'clockwise ‚Üª' : 'counterclockwise ‚Ü∫'}.`;
        }
        feedbackHTML += ` ${p.feedback}`;
        if (p.work) feedbackHTML += `<div class="work">${p.work}</div>`;
        fb.className = 'feedback incorrect';

        // Level down after 2 consecutive wrong
        if (consecutiveWrong >= 2 && level > 0) {
          level--;
          consecutiveWrong = 0;
          feedbackHTML += `<br><br>‚¨áÔ∏è Dropping to ${['Easy', 'Medium', 'Hard'][level]} level for more practice.`;
        }
      }

      fb.innerHTML = feedbackHTML;
      document.getElementById('nextBtn').style.display = 'block';
      updateStats();

      // Check mastery
      if (correct >= MASTERY_TARGET) {
        setTimeout(showMastery, 800);
      }
    }

    // ====== UPDATE UI ======
    function updateStats() {
      document.getElementById('correctCount').textContent = correct;
      document.getElementById('totalCount').textContent = total;
      document.getElementById('streakCount').textContent = streak;

      const badge = document.getElementById('levelBadge');
      const names = ['Easy', 'Medium', 'Hard'];
      const classes = ['easy', 'medium', 'hard'];
      badge.textContent = names[level];
      badge.className = 'value ' + classes[level];

      const pct = Math.min((correct / MASTERY_TARGET) * 100, 100);
      document.getElementById('progressFill').style.width = pct + '%';
      document.getElementById('progressText').textContent = `${correct} / ${MASTERY_TARGET} correct needed`;
    }

    function showMastery() {
      const overlay = document.getElementById('masteryOverlay');
      overlay.classList.add('show');

      const pct = total > 0 ? Math.round((correct / total) * 100) : 0;
      document.getElementById('masteryStats').innerHTML = `
        <strong>${correct}</strong> correct out of <strong>${total}</strong> total (${pct}%)<br>
        Best Streak: <strong>${bestStreak}</strong><br>
        Final Level: <strong>${['Easy', 'Medium', 'Hard'][level]}</strong>
      `;

      const now = new Date();
      document.getElementById('masteryTimestamp').textContent =
        now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) +
        ' at ' + now.toLocaleTimeString('en-US');
    }

    // ====== INIT ======
    generateProblem();
  </script>
</body>
</html>
